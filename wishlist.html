<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist - BookWise</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- Header / Navigation -->
    <header class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-book-open"></i> BookWise
            </a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="featured.html">Featured</a></li>
                    <li><a href="genres.html">Genres</a></li>
                    <li><a href="community.html">Community</a></li>
                    <li><a href="wishlist.html" class="active">Wishlist</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <a href="login.html" class="btn-text">Log In</a>
                <a href="signup.html" class="btn-primary">Sign Up</a>
            </div>
        </div>
    </header>

    <main class="container" style="margin-top: 40px; min-height: 80vh;">
        <h1 style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 10px;">My Wishlist</h1>

        <div id="wishlist-grid" class="books-grid">
            <!-- Wishlist items will be loaded here -->
            <p id="wishlist-loading">Loading your favorites...</p>
        </div>

        <div id="empty-wishlist" style="display: none; text-align: center; margin-top: 100px;">
            <i class="fas fa-heart-broken" style="font-size: 60px; color: #ddd; margin-bottom: 20px;"></i>
            <h3>Your wishlist is empty.</h3>
            <p>Go explore some books and add them to your favorites!</p>
            <a href="index.html" class="btn-primary"
                style="display: inline-block; margin-top: 20px; padding: 12px 30px;">Explore Books</a>
        </div>
    </main>

    <footer>
        <div class="container footer-container">
            <div class="footer-brand">
                <a href="#" class="logo-light"><i class="fas fa-book-open"></i> BookWise</a>
                <p>Connecting readers with their next literary obsession.</p>
            </div>
            <div class="footer-links">
                <div class="link-group">
                    <h4>Platform</h4>
                    <a href="featured.html">Browse</a>
                    <a href="community.html">Community</a>
                    <a href="wishlist.html">Wishlist</a>
                </div>
                <div class="link-group">
                    <h4>Company</h4>
                    <a href="#">About</a>
                    <a href="#">Careers</a>
                    <a href="#">Contact</a>
                </div>
            </div>
        </div>
        <div class="container footer-bottom">
            <p>&copy; 2024 BookWise. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const grid = document.getElementById('wishlist-grid');
            const emptyMsg = document.getElementById('empty-wishlist');
            const loading = document.getElementById('wishlist-loading');

            try {
                const response = await fetch('api/wishlist.php');
                const data = await response.json();

                if (!data.success) {
                    if (data.error === 'User not logged in') {
                        loading.innerHTML = 'Please <a href="login.html">Sign In</a> to view your wishlist.';
                    } else {
                        loading.innerHTML = 'Failed to load wishlist: ' + data.error;
                    }
                    return;
                }

                if (data.wishlist.length === 0) {
                    loading.style.display = 'none';
                    emptyMsg.style.display = 'block';
                    return;
                }

                loading.style.display = 'none';
                grid.innerHTML = ''; // Clear loading text

                data.wishlist.forEach(book => {
                    const bookData = encodeURIComponent(JSON.stringify(book));
                    const bookCard = `
                        <div class="book-card" style="position: relative; cursor: pointer;" onclick="showBookDetails('${bookData}')">
                            <div class="book-cover">
                                <img src="${book.cover_image}" alt="${book.title}">
                                <button class="wishlist-heart-btn" onclick="toggleWishlistOnCard(event, ${book.id})">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                            <div class="book-info">
                                <h3 class="book-title">${book.title}</h3>
                                <p class="book-author">${book.author}</p>
                                <div class="book-rating">
                                    <i class="fas fa-star stars-gold"></i>
                                    <span>${book.rating}</span>
                                </div>
                                <p class="book-price">Rs. ${book.price}</p>
                            </div>
                        </div>
                    `;
                    grid.innerHTML += bookCard;
                });

            } catch (error) {
                console.error("Wishlist fetch failed:", error);
                loading.innerHTML = 'An error occurred while loading your wishlist.';
            }
        });
    </script>
</body>

</html>